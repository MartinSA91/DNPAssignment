@page "/create-post"
@using ApiContracts
@using BlazorApp.Services
@inject IPostService PostService
@inject IUserService UserService
@inject NavigationManager Nav

<h3>Create Post</h3>

<div class="form-group">
    <label>Title:</label>
    <input @bind="title" class="form-control" placeholder="Post title" />
</div>

<div class="form-group mt-2">
    <label>Body:</label>
    <textarea @bind="body" class="form-control" placeholder="Post content"></textarea>
</div>

<div class="form-group mt-2">
    <label>Author:</label>
    <select @bind="selectedUserId" class="form-select">
        <option value="">-- Select user --</option>
        @foreach (var user in users)
        {
            <option value="@user.Id">@user.UserName</option>
        }
    </select>
</div>

<button class="btn btn-primary mt-3" @onclick="CreatePostAsync">Create Post</button>

@if (!string.IsNullOrEmpty(message))
{
    <div class="alert alert-info mt-3">@message</div>
}

@code {
    private string title = "";
    private string body = "";
    private int? selectedUserId;
    private List<UserDto> users = new();
    private string message = "";

    protected override async Task OnInitializedAsync()
    {
        users = await UserService.GetUsersAsync();
    }

    private async Task CreatePostAsync()
    {
        if (selectedUserId is null)
        {
            message = "Please select an author.";
            return;
        }

        try
        {
            await PostService.AddPostAsync(new PostCreateDto(title, body, selectedUserId.Value));
            Nav.NavigateTo("/posts");
        }
        catch (Exception ex)
        {
            message = $"Error: {ex.Message}";
        }
    }
}